<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo-and-title">
          <img src="../assets/icons/icon128.png" alt="Claude Annotations" class="header-logo">
          <div class="title-section">
            <h1 class="title">Claude Annotations</h1>
            <p class="subtitle" id="current-route"></p>
          </div>
        </div>
        <button id="settings-btn" class="icon-btn" title="Settings">
          <iconify-icon icon="heroicons-outline:cog-6-tooth" width="16" height="16"></iconify-icon>
        </button>
      </div>
    </header>
    
    <main class="main">
      <!-- Welcome Screen (when server not detected) -->
      <div id="welcome-screen" class="welcome-screen" style="display: none;">
        <div class="welcome-content">
          <div class="welcome-icon">
            <iconify-icon icon="heroicons:wrench-screwdriver" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="welcome-title">One-time Setup Required</h2>
          <p class="welcome-text">
            Claude Annotations needs a local server to work with Claude Code.
          </p>
          
          <div class="setup-commands">
            <div class="command-section">
              <h3>Run these commands in your terminal:</h3>
              
              <div class="command-item">
                <span class="command-number">1.</span>
                <div class="command-content">
                  <div class="command-label">Install server:</div>
                  <div class="command-code">
                    <code>npm install -g git+https://github.com/RaphaelRegnier/claude-annotations-server.git</code>
                    <button class="copy-btn" data-command="npm install -g git+https://github.com/RaphaelRegnier/claude-annotations-server.git" title="Copy command">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="command-item">
                <span class="command-number">2.</span>
                <div class="command-content">
                  <div class="command-label">Start server:</div>
                  <div class="command-code">
                    <code>claude-annotations-server start</code>
                    <button class="copy-btn" data-command="claude-annotations-server start" title="Copy command">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="command-item">
                <span class="command-number">3.</span>
                <div class="command-content">
                  <div class="command-label">Connect Claude Code:</div>
                  <div class="command-code">
                    <code>claude mcp add --transport sse claude-annotations http://127.0.0.1:3846/sse</code>
                    <button class="copy-btn" data-command="claude mcp add --transport sse claude-annotations http://127.0.0.1:3846/sse" title="Copy command">
                      <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="command-actions">
              <button id="copy-all-commands" class="secondary-btn">
                <iconify-icon icon="lucide:copy" width="16" height="16"></iconify-icon>
                Copy All Commands
              </button>
              <button id="how-it-works-btn" class="text-btn">
                <iconify-icon icon="lucide:help-circle" width="16" height="16"></iconify-icon>
                How it Works
              </button>
            </div>
          </div>
          
          <div class="server-status-section">
            <div class="server-status-indicator">
              <span class="status-label">Server Status:</span>
              <span id="server-status-text" class="status-offline">❌ Not detected</span>
            </div>
            <button id="check-server-btn" class="secondary-btn">
              <iconify-icon icon="lucide:refresh-cw" width="16" height="16"></iconify-icon>
              Check Again
            </button>
          </div>
        </div>
      </div>

      <!-- Setup Complete Screen -->
      <div id="setup-complete-screen" class="setup-complete-screen" style="display: none;">
        <div class="setup-complete-content">
          <div class="setup-complete-icon">
            <iconify-icon icon="heroicons:check-circle" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="setup-complete-title">✅ Setup Complete!</h2>
          <div class="server-info">
            <div class="server-status-indicator">
              <span class="status-label">Server Status:</span>
              <span id="server-running-status" class="status-online">✅ Running (:3846)</span>
            </div>
          </div>
          <p class="setup-complete-text">
            Ready to annotate! Start using annotation tools in Claude Code.
          </p>
          <div class="server-actions">
            <button id="view-logs-btn" class="secondary-btn">
              <iconify-icon icon="lucide:file-text" width="16" height="16"></iconify-icon>
              View Server Logs
            </button>
            <button id="restart-server-btn" class="secondary-btn">
              <iconify-icon icon="lucide:refresh-cw" width="16" height="16"></iconify-icon>
              Restart Server
            </button>
          </div>
        </div>
      </div>

      <!-- How It Works Screen -->
      <div id="how-it-works-screen" class="how-it-works-screen" style="display: none;">
        <div class="how-it-works-content">
          <div class="how-it-works-header">
            <button id="back-to-setup-btn" class="icon-btn">
              <iconify-icon icon="lucide:arrow-left" width="16" height="16"></iconify-icon>
            </button>
            <h2>How it Works</h2>
          </div>
          
          <div class="how-it-works-body">
            <div class="instruction-section">
              <h3>One-Time Setup:</h3>
              <ol class="instruction-list">
                <li>
                  <strong>Install the server globally:</strong>
                  <div class="code-block">
                    <code>npm install -g git+https://github.com/RaphaelRegnier/claude-annotations-server.git</code>
                  </div>
                </li>
                <li>
                  <strong>Start the server:</strong>
                  <div class="code-block">
                    <code>claude-annotations-server start</code>
                  </div>
                  <p class="instruction-note">The server will run in the background globally</p>
                </li>
                <li>
                  <strong>Navigate to your project directory:</strong>
                  <div class="code-block">
                    <code>cd /path/to/your/project</code>
                  </div>
                  <p class="instruction-note">Go to the project where you want to use Claude Annotations</p>
                </li>
                <li>
                  <strong>Connect Claude Code to the server:</strong>
                  <div class="code-block">
                    <code>claude mcp add --transport sse claude-annotations http://127.0.0.1:3846/sse</code>
                  </div>
                  <p class="instruction-note">Run this command in each project directory where you want annotations</p>
                </li>
                <li>
                  <strong>Start Claude Code in this project:</strong>
                  <div class="code-block">
                    <code>claude-code</code>
                  </div>
                </li>
              </ol>
            </div>
            
            <div class="instruction-section">
              <h3>Server Management:</h3>
              <div class="server-management">
                <div class="management-item">
                  <strong>To stop the server:</strong>
                  <div class="code-block">
                    <code>claude-annotations-server stop</code>
                  </div>
                </div>
                <div class="management-item">
                  <strong>To restart the server:</strong>
                  <div class="code-block">
                    <code>claude-annotations-server restart</code>
                  </div>
                </div>
                <div class="management-item">
                  <strong>To check if server is running:</strong>
                  <div class="code-block">
                    <code>claude-annotations-server status</code>
                  </div>
                </div>
              </div>
              
              <div class="warning-note">
                <iconify-icon icon="lucide:alert-triangle" width="16" height="16"></iconify-icon>
                <span><strong>Important:</strong> If you stop the server, you must restart Claude Code to reconnect when you start it again.</span>
              </div>
            </div>
            
            <div class="instruction-section">
              <h3>Working with Different Projects:</h3>
              <ul class="instruction-list">
                <li>The server runs once globally and serves all projects</li>
                <li>For each new project, run <code>claude mcp add --transport sse claude-annotations http://127.0.0.1:3846/sse</code> in that project directory</li>
                <li>Start Claude Code from the project directory to use annotations in that specific project</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Ready Screen (when online with no annotations) -->
      <div id="ready-screen" class="ready-screen" style="display: none;">
        <div class="ready-content">
          <div class="ready-icon">
            <iconify-icon icon="heroicons:rocket-launch" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="ready-title">Ready for your annotations</h2>
          <p class="ready-text">
            Click the button below to launch inspection mode and add annotations for Claude.
          </p>
        </div>
      </div>

      <!-- Annotations List -->
      <div id="annotations-list" class="annotations-list"></div>
    </main>
    
    <footer class="footer">
      <div class="footer-content">
        <button id="new-annotation-btn" class="primary-btn">
          <iconify-icon icon="lucide:plus" width="16" height="16"></iconify-icon>
          Start Annotating
        </button>
        <div id="mcp-status" class="mcp-status" title="MCP Connection Status">
          <div class="status-indicator offline"></div>
          <span class="status-text">MCP</span>
        </div>
      </div>
    </footer>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay" style="display: none;">
      <div class="modal">
        <div class="modal-header">
          <h3>Settings</h3>
          <button id="close-settings" class="icon-btn">
            <iconify-icon icon="lucide:x" width="16" height="16"></iconify-icon>
          </button>
        </div>
        <div class="modal-content">
          <div class="setting-group">
            <label for="theme-select">Theme</label>
            <select id="theme-select" class="theme-select">
              <option value="system">System</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="iconify-icon.min.js"></script>
  <script src="themes.js"></script>
  <script src="popup.js"></script>
</body>
</html>
