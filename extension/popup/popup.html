<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo-and-title">
          <img src="../assets/icons/icon128.png" alt="Vibe Annotations" class="header-logo">
          <div class="title-section">
            <h1 class="title">Vibe Annotations</h1>
            <p class="subtitle" id="current-route"></p>
          </div>
        </div>
        <div class="header-actions">
          <button id="get-started-header-btn" class="icon-btn" title="Docs">
            <iconify-icon icon="heroicons-outline:book-open" width="16" height="16"></iconify-icon>
          </button>
          <button id="settings-btn" class="icon-btn" title="Settings">
            <iconify-icon icon="heroicons-outline:cog-6-tooth" width="16" height="16"></iconify-icon>
          </button>
        </div>
      </div>
    </header>
    
    <main class="main">
      <!-- Welcome Screen (when server not detected) -->
      <div id="welcome-screen" class="welcome-screen" style="display: none;">
        <div class="welcome-content">
          <div class="welcome-logo">
            <img src="../assets/icons/icon128.png" alt="Vibe Annotations" width="48" height="48">
          </div>
          <h2 class="welcome-title">Welcome to Vibe Annotations!</h2>
          <p class="welcome-description">
            Vibe Annotations gives your Claude Code superpowers, allowing it to bulk-treat all your visual annotations across different pages, while minding responsiveness.
          </p>
          <button id="get-started-btn" class="primary-btn get-started-btn">
            Get started (1min)
          </button>
        </div>
      </div>

      <!-- Get Started Screen (setup instructions) -->
      <div id="get-started-screen" class="get-started-screen" style="display: none;">
        <div class="get-started-content">
          <div class="get-started-header">
            <button id="back-to-welcome-btn" class="icon-btn">
              <iconify-icon icon="lucide:arrow-left" width="16" height="16"></iconify-icon>
            </button>
            <h2>Get started (1min)</h2>
          </div>
          
          <div class="get-started-body">
            <div class="rich-text-content">
              <p>To read your annotations, Claude Code needs to communicate to an MCP + HTTP API server that will run on your local machine.</p>
              
              <h3>1. Download and install the npm server globally by running:</h3>
              <div class="command-code">
                <code>npm install -g git+https://github.com/RaphaelRegnier/vibe-annotations-server.git</code>
                <button class="copy-btn" data-command="npm install -g git+https://github.com/RaphaelRegnier/vibe-annotations-server.git" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <h3>2. Start the server on your local machine:</h3>
              <div class="command-code">
                <code>vibe-annotations-server start --daemon</code>
                <button class="copy-btn" data-command="vibe-annotations-server start --daemon" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              <p>This will keep the server running in the background</p>
              
              <h3>3. Go to your project repo where Claude Code is installed, and run:</h3>
              <div class="command-code">
                <code>claude mcp add --transport sse vibe-annotations http://127.0.0.1:3846/sse</code>
                <button class="copy-btn" data-command="claude mcp add --transport sse vibe-annotations http://127.0.0.1:3846/sse" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              <p>To verify your installation, run <code>/mcp</code> inside of Claude Code and you should see the vibe-annotations MCP server connected.</p>
              
              <h2><strong>How it works</strong></h2>
              <p>Vibe Annotations only works when your local server is on, and the project host is localhost, 127.0.0.1, 0.0.0.0, or *.local. It recognizes common localhost and HTML local files.</p>
              
              <h3>1. Click "Start annotating"</h3>
              <p>You will enter an inspection mode to drop annotations, super fast! To exit, press Esc or reopen the popup and click "Stop annotating".</p>
              
              <h3>2. Drop your annotations, minding responsiveness.</h3>
              <p>Each annotation saves the window size, so Claude Code will mind your breakpoints when working on your feedbacks. Example: If you want to change an H1 fontsize only on mobile, just adjust your window size directly on your browser, or devtools. You can also specify it in your annotation.</p>
              
              <p><strong>Pro tips:</strong></p>
              <ul>
                <li>You can edit, find and delete annotations in the extension popup.</li>
                <li>You can drop annotations on multiple pages and projects.</li>
              </ul>
              
              <h3>3. Ask Claude Code to read and implement your comments/feedbacks/annotations.</h3>
              <p>Claude Code will automatically call the MCP tools, read your annotations, understand their context and implement changes unless they are unclear. Once treated, Claude Code will automatically delete the annotations forever, and you're ready for the next batch!</p>
              
              <p>You're done! Work faster than ever!</p>
              
              <h2>Useful tips</h2>
              
              <h3>1. Server commands</h3>
              <div class="command-code">
                <code>vibe-annotations-server --help</code>
                <button class="copy-btn" data-command="vibe-annotations-server --help" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <h3>2. Reconnect MCP</h3>
              <p>Claude Code loads the MCPs only once upon start. If you restart your MCP server, you will have to kill and restart your Claude Code session(s).</p>
              
              <h3>3. Clean uninstallation of Vibe Annotations</h3>
              <p>First remove the mcp:</p>
              <div class="command-code">
                <code>claude mcp remove vibe-annotations</code>
                <button class="copy-btn" data-command="claude mcp remove vibe-annotations" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <p>Then uninstall the npm server globally:</p>
              <div class="command-code">
                <code>npm uninstall -g vibe-annotations-server</code>
                <button class="copy-btn" data-command="npm uninstall -g vibe-annotations-server" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <p>Remove the data file:</p>
              <div class="command-code">
                <code>rm -rf ~/.vibe-annotations</code>
                <button class="copy-btn" data-command="rm -rf ~/.vibe-annotations" title="Copy command">
                  <iconify-icon icon="lucide:copy" width="14" height="14"></iconify-icon>
                </button>
              </div>
              
              <p>Then delete the browser extension.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Setup Complete Screen -->
      <div id="setup-complete-screen" class="setup-complete-screen" style="display: none;">
        <div class="setup-complete-content">
          <div class="setup-complete-icon">
            <iconify-icon icon="heroicons:check-circle" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="setup-complete-title">✅ Setup Complete!</h2>
          <div class="server-info">
            <div class="server-status-indicator">
              <span class="status-label">Server Status:</span>
              <span id="server-running-status" class="status-online">✅ Running (:3846)</span>
            </div>
          </div>
          <p class="setup-complete-text">
            Ready to annotate! Start using annotation tools in Claude Code.
          </p>
          <div class="server-actions">
            <button id="view-logs-btn" class="secondary-btn">
              <iconify-icon icon="lucide:file-text" width="16" height="16"></iconify-icon>
              View Server Logs
            </button>
            <button id="restart-server-btn" class="secondary-btn">
              <iconify-icon icon="lucide:refresh-cw" width="16" height="16"></iconify-icon>
              Restart Server
            </button>
          </div>
        </div>
      </div>

      <!-- How It Works Screen -->
      <div id="how-it-works-screen" class="how-it-works-screen" style="display: none;">
        <div class="how-it-works-content">
          <div class="how-it-works-header">
            <button id="back-to-setup-btn" class="icon-btn">
              <iconify-icon icon="lucide:arrow-left" width="16" height="16"></iconify-icon>
            </button>
            <h2>How it Works</h2>
          </div>
          
          <div class="how-it-works-body">
            <div class="instruction-section">
              <h3>One-Time Setup:</h3>
              <ol class="instruction-list">
                <li>
                  <strong>Install the server globally:</strong>
                  <div class="code-block">
                    <code>npm install -g git+https://github.com/RaphaelRegnier/vibe-annotations-server.git</code>
                  </div>
                </li>
                <li>
                  <strong>Start the server:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server start</code>
                  </div>
                  <p class="instruction-note">The server will run in the background globally</p>
                </li>
                <li>
                  <strong>Navigate to your project directory:</strong>
                  <div class="code-block">
                    <code>cd /path/to/your/project</code>
                  </div>
                  <p class="instruction-note">Go to the project where you want to use Claude Annotations</p>
                </li>
                <li>
                  <strong>Connect Claude Code to the server:</strong>
                  <div class="code-block">
                    <code>claude mcp add --transport sse vibe-annotations http://127.0.0.1:3846/sse</code>
                  </div>
                  <p class="instruction-note">Run this command in each project directory where you want annotations</p>
                </li>
                <li>
                  <strong>Start Claude Code in this project:</strong>
                  <div class="code-block">
                    <code>claude-code</code>
                  </div>
                </li>
              </ol>
            </div>
            
            <div class="instruction-section">
              <h3>Server Management:</h3>
              <div class="server-management">
                <div class="management-item">
                  <strong>To stop the server:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server stop</code>
                  </div>
                </div>
                <div class="management-item">
                  <strong>To restart the server:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server restart</code>
                  </div>
                </div>
                <div class="management-item">
                  <strong>To check if server is running:</strong>
                  <div class="code-block">
                    <code>vibe-annotations-server status</code>
                  </div>
                </div>
              </div>
              
              <div class="warning-note">
                <iconify-icon icon="lucide:alert-triangle" width="16" height="16"></iconify-icon>
                <span><strong>Important:</strong> If you stop the server, you must restart Claude Code to reconnect when you start it again.</span>
              </div>
            </div>
            
            <div class="instruction-section">
              <h3>Working with Different Projects:</h3>
              <ul class="instruction-list">
                <li>The server runs once globally and serves all projects</li>
                <li>For each new project, run <code>claude mcp add --transport sse vibe-annotations http://127.0.0.1:3846/sse</code> in that project directory</li>
                <li>Start Claude Code from the project directory to use annotations in that specific project</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Ready Screen (when online with no annotations) -->
      <div id="ready-screen" class="ready-screen" style="display: none;">
        <div class="ready-content">
          <div class="ready-icon">
            <iconify-icon icon="heroicons:rocket-launch" width="32" height="32"></iconify-icon>
          </div>
          <h2 class="ready-title">Ready for your annotations</h2>
          <p class="ready-text">
            Click the button below to launch inspection mode and add annotations for Claude Code.
          </p>
        </div>
      </div>

      <!-- Annotations List -->
      <div id="annotations-list" class="annotations-list"></div>
    </main>
    
    <footer class="footer">
      <div class="footer-content">
        <button id="new-annotation-btn" class="primary-btn">
          <iconify-icon icon="lucide:plus" width="16" height="16"></iconify-icon>
          Start Annotating
        </button>
        <div class="footer-status">
          <div id="mcp-status" class="mcp-status" title="MCP Connection Status">
            <div class="status-indicator offline"></div>
            <span class="status-text">API offline</span>
          </div>
          <button id="refresh-status-btn" class="icon-btn" title="Refresh connection">
            <iconify-icon icon="heroicons-outline:arrow-path" width="16" height="16"></iconify-icon>
          </button>
        </div>
      </div>
    </footer>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay" style="display: none;">
      <div class="modal">
        <div class="modal-header">
          <h3>Settings</h3>
          <button id="close-settings" class="icon-btn">
            <iconify-icon icon="lucide:x" width="16" height="16"></iconify-icon>
          </button>
        </div>
        <div class="modal-content">
          <div class="setting-group">
            <label for="theme-select">Theme</label>
            <select id="theme-select" class="theme-select">
              <option value="system">System</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="iconify-icon.min.js"></script>
  <script src="themes.js"></script>
  <script src="popup.js"></script>
</body>
</html>
